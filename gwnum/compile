# Assembler command lines
#
# Uasm is a MASM-compatible assembler that is supported much better than MASM.
# It can be downloaded at http://www.terraspace.co.uk/uasm.html
#
# objconv comes courtesy of Agner Fog.  Download available at
# http://www.agner.org/optimize/#objconv

masm=uasm64 /c -coff -safeseh
#masm=uasm64 /c -Fl -coff -safeseh
#masm=uasm64 /c -Fl -Sf -Sa -Sg -coff -safeseh
#masm=ml /c /coff
#masm=ml /c /coff /Fl /Sf /Sa

# Use the MSVC 8 C compiler

cl=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /O2 /Op /c
cld=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /Op /c
cldo=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /O2 /Op /c
objconv=c:\objconv\objconv

# List of all buildables in this makefile

all:	gwnumd.lib gwnum.lib linux\gwnum.a macosx\gwnum.a release\ecmstag1.obj debug\ecmstag1.obj

# Make libraries out of the object files

gwnumd.lib: debug\cpuid.obj debug\gwnum.obj debug\gwtables.obj debug\gwthread.obj debug\gwini.obj debug\gwbench.obj debug\gwutil.obj \
	    debug\gwdbldbl.obj debug\giants.obj debug\radix.obj mult.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj \
	    mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj hyperhlp.obj \
	    xmult1ax.obj xmult2.obj xmult2a_core.obj xmult2a_k8.obj xmult2ax.obj xmult3.obj xmult3a_core.obj xmult3a_k8.obj xmult3ax.obj \
	    hg_blend.obj hg_core.obj hg_p4.obj hg_p4tp.obj hg_k8.obj hg_k10.obj \
	    r4_core.obj r4_p4.obj r4_p4tp.obj r4_k8.obj r4_k10.obj \
	    r4delay_core.obj r4delay_p4.obj r4delay_p4tp.obj r4delay_k8.obj r4delay_k10.obj \
	    r4delay3_core.obj r4delay3_p4.obj r4delay3_p4tp.obj r4delay3_k8.obj r4delay3_k10.obj \
	    r4delay5_core.obj r4delay5_p4.obj r4delay5_p4tp.obj r4delay5_k8.obj r4delay5_k10.obj \
	    r4dwpn_core.obj r4dwpn_p4.obj r4dwpn_p4tp.obj r4dwpn_k8.obj r4dwpn_k10.obj \
	    r4dwpn3_core.obj r4dwpn3_p4.obj r4dwpn3_p4tp.obj r4dwpn3_k8.obj r4dwpn3_k10.obj \
	    r4dwpn5_core.obj r4dwpn5_p4.obj r4dwpn5_p4tp.obj r4dwpn5_k8.obj r4dwpn5_k10.obj \
	    ymult1ax_core.obj yr4_core.obj \
	    ymult3.obj ymult3a_core.obj ymult3ax.obj \
	    yr4dwpn_core.obj yr4dwpn3_core.obj yr4dwpn4_core.obj yr4dwpn5_core.obj \
	    timeit.obj
    -del gwnumd.lib
    lib /OUT:gwnumd.lib debug\*.obj *.obj

gwnum.lib: release\cpuid.obj release\gwnum.obj release\gwtables.obj release\gwthread.obj release\gwini.obj release\gwbench.obj \
	   release\gwutil.obj release\gwdbldbl.obj release\giants.obj release\radix.obj mult.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj \
	   mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj hyperhlp.obj \
	   xmult1ax.obj xmult2.obj xmult2a_core.obj xmult2a_k8.obj xmult2ax.obj xmult3.obj xmult3a_core.obj xmult3a_k8.obj xmult3ax.obj \
	   hg_blend.obj hg_core.obj hg_p4.obj hg_p4tp.obj hg_k8.obj hg_k10.obj \
	   r4_core.obj r4_p4.obj r4_p4tp.obj r4_k8.obj r4_k10.obj \
	   r4delay_core.obj r4delay_p4.obj r4delay_p4tp.obj r4delay_k8.obj r4delay_k10.obj \
	   r4delay3_core.obj r4delay3_p4.obj r4delay3_p4tp.obj r4delay3_k8.obj r4delay3_k10.obj \
	   r4delay5_core.obj r4delay5_p4.obj r4delay5_p4tp.obj r4delay5_k8.obj r4delay5_k10.obj \
	   r4dwpn_core.obj r4dwpn_p4.obj r4dwpn_p4tp.obj r4dwpn_k8.obj r4dwpn_k10.obj \
	   r4dwpn3_core.obj r4dwpn3_p4.obj r4dwpn3_p4tp.obj r4dwpn3_k8.obj r4dwpn3_k10.obj \
	   r4dwpn5_core.obj r4dwpn5_p4.obj r4dwpn5_p4tp.obj r4dwpn5_k8.obj r4dwpn5_k10.obj \
	   ymult1ax_core.obj yr4_core.obj \
	   ymult3.obj ymult3a_core.obj ymult3ax.obj \
	   yr4dwpn_core.obj yr4dwpn3_core.obj yr4dwpn4_core.obj yr4dwpn5_core.obj \
	   timeit.obj
    -del gwnum.lib
    lib /OUT:gwnum.lib release\*.obj *.obj

clean:
	-del release\*.obj debug\*.obj

linux\gwnum.a: mult.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj \
	       mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj hyperhlp.obj \
	       xmult1ax.obj xmult2.obj xmult2a_core.obj xmult2a_k8.obj xmult2ax.obj xmult3.obj xmult3a_core.obj xmult3a_k8.obj xmult3ax.obj \
	       hg_blend.obj hg_core.obj hg_p4.obj hg_p4tp.obj hg_k8.obj hg_k10.obj \
	       r4_core.obj r4_p4.obj r4_p4tp.obj r4_k8.obj r4_k10.obj \
	       r4delay_core.obj r4delay_p4.obj r4delay_p4tp.obj r4delay_k8.obj r4delay_k10.obj \
	       r4delay3_core.obj r4delay3_p4.obj r4delay3_p4tp.obj r4delay3_k8.obj r4delay3_k10.obj \
	       r4delay5_core.obj r4delay5_p4.obj r4delay5_p4tp.obj r4delay5_k8.obj r4delay5_k10.obj \
	       r4dwpn_core.obj r4dwpn_p4.obj r4dwpn_p4tp.obj r4dwpn_k8.obj r4dwpn_k10.obj \
	       r4dwpn3_core.obj r4dwpn3_p4.obj r4dwpn3_p4tp.obj r4dwpn3_k8.obj r4dwpn3_k10.obj \
	       r4dwpn5_core.obj r4dwpn5_p4.obj r4dwpn5_p4tp.obj r4dwpn5_k8.obj r4dwpn5_k10.obj \
	       ymult1ax_core.obj yr4_core.obj \
	       ymult3.obj ymult3a_core.obj ymult3ax.obj \
	       yr4dwpn_core.obj yr4dwpn3_core.obj yr4dwpn4_core.obj yr4dwpn5_core.obj \
	       timeit.obj
    attrib -r linux\gwnum.a
    -del linux\gwnum.a
    -del linux\gwnum.lib
    lib /OUT:linux\gwnum.lib *.obj
    $(objconv) -felf32 linux\gwnum.lib linux\gwnum.a
    attrib -r linux\gwnum.a
    -del linux\gwnum.lib

macosx\gwnum.a: macosx\mult.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj \
		mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj hyperhlp.obj \
		xmult1ax.obj xmult2.obj xmult2a_core.obj xmult2ax.obj xmult3.obj xmult3a_core.obj xmult3ax.obj \
		hg_blend.obj hg_core.obj hg_p4.obj \
		r4_core.obj r4_p4.obj \
		r4delay_core.obj r4delay_p4.obj \
		r4delay3_core.obj r4delay3_p4.obj \
		r4delay5_core.obj r4delay5_p4.obj \
		r4dwpn_core.obj r4dwpn_p4.obj \
		r4dwpn3_core.obj r4dwpn3_p4.obj \
		r4dwpn5_core.obj r4dwpn5_p4.obj \
		ymult1ax_core.obj yr4_core.obj \
		ymult3.obj ymult3a_core.obj ymult3ax.obj \
		yr4dwpn_core.obj yr4dwpn3_core.obj yr4dwpn4_core.obj yr4dwpn5_core.obj \
		timeit.obj
    attrib -r macosx\gwnum.a
    -del /q macosx\foo
    -del macosx\gwnum.a
    -del macosx\gwnum.lib
    mkdir macosx\foo
    copy macosx\mult.obj macosx\foo
    -del macosx\*.obj
    xcopy /q *.obj macosx
    -del macosx\*_p4tp.obj
    -del macosx\*_k8.obj
    -del macosx\*_k10.obj
    xcopy /y /q macosx\foo macosx
    lib /OUT:macosx\gwnum.lib macosx\*.obj
    $(objconv) -fmacho32 -wd1050 macosx\gwnum.lib macosx\gwnum.a
    attrib -r macosx\gwnum.a
    -del macosx\gwnum.lib
    -del macosx\*.obj
    xcopy /q macosx\foo macosx
    -del /q macosx\foo
    rmdir macosx\foo

# Compile C code

release\cpuid.obj: cpuid.c cpuid.h
    $(cl) /Forelease\cpuid.obj cpuid.c

debug\cpuid.obj: cpuid.c cpuid.h
    $(cld) /Fodebug\cpuid.obj cpuid.c

release\gwnum.obj: gwnumVC6.c gwnum.h
    $(cl) /Forelease\gwnum.obj gwnumVC6.c

debug\gwnum.obj: gwnumVC6.c gwnum.h
    $(cld) /Fodebug\gwnum.obj gwnumVC6.c

release\gwtables.obj: gwtables.c gwnum.h
    $(cl) /Forelease\gwtables.obj gwtables.c

debug\gwtables.obj: gwtables.c gwnum.h
    $(cld) /Fodebug\gwtables.obj gwtables.c

release\gwthread.obj: gwthread.c gwthread.h
    $(cl) /Forelease\gwthread.obj gwthread.c

debug\gwthread.obj: gwthread.c gwthread.h
    $(cld) /Fodebug\gwthread.obj gwthread.c

release\gwini.obj: gwini.c gwini.h
    $(cl) /Forelease\gwini.obj gwini.c

debug\gwini.obj: gwini.c gwini.h
    $(cld) /Fodebug\gwini.obj gwini.c

release\gwbench.obj: gwbench.c gwbench.h gwnum.h
    $(cl) /I..\sqlite-amalgamation-3180000 /Forelease\gwbench.obj gwbench.c

debug\gwbench.obj: gwbench.c gwbench.h gwnum.h
    $(cld) /I..\sqlite-amalgamation-3180000 /Fodebug\gwbench.obj gwbench.c

release\gwutil.obj: gwutilVC6.c gwutil.h
    $(cl) /Forelease\gwutil.obj gwutilVC6.c

debug\gwutil.obj: gwutilVC6.c gwutil.h
    $(cld) /Fodebug\gwutil.obj gwutilVC6.c

release\gwdbldbl.obj: gwdbldblVC6.cpp gwdbldbl.h
    $(cl) /I..\qd /Forelease\gwdbldbl.obj gwdbldblVC6.cpp

debug\gwdbldbl.obj: gwdbldblVC6.cpp gwdbldbl.h
    $(cldo) /I..\qd /Fodebug\gwdbldbl.obj gwdbldblVC6.cpp

release\giants.obj: giants.c giants.h
    $(cl) /Forelease\giants.obj giants.c

debug\giants.obj: giants.c giants.h
    $(cldo) /Fodebug\giants.obj giants.c

release\radix.obj: radixVC6.c radix.h gwnum.h
    $(cl) /Forelease\radix.obj radixVC6.c

debug\radix.obj: radixVC6.c radix.h gwnum.h
    $(cld) /Fodebug\radix.obj radixVC6.c

release\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cl)  /Ic:\gmp32 /Forelease\ecmstag1.obj ecmstag1.c

debug\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cld) /Ic:\gmp32 /Fodebug\ecmstag1.obj ecmstag1.c
