# Assembler command lines, without and with listings
#
# objconv comes courtesy of Agner Fog.  Download available at
# http://www.agner.org/optimize/#objconv

masm=ml /c /coff
#masm=ml /c /coff /Fl /Sf /Sa

# Use the MSVC 6 C compiler

cl=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /O2 /Op /c
cld=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /Op /c
cldo=cl /GF /W3 /MT /D_CRT_SECURE_NO_DEPRECATE /DGDEBUG /Z7 /O2 /Op /c
objconv=c:\objconv\objconv

# List of all buildables in this makefile

all:	gwnum.lib gwnumd.lib linux\gwnum.a macosx\gwnum.a release\ecmstag1.obj debug\ecmstag1.obj

# Make libraries out of the object files

gwnum.lib: release\cpuid.obj release\gwnum.obj release\gwthread.obj release\gwutil.obj release\gwdbldbl.obj release\giants.obj mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    -del gwnum.lib
    lib /OUT:gwnum.lib release\*.obj *.obj

gwnumd.lib: debug\cpuid.obj debug\gwnum.obj debug\gwthread.obj debug\gwutil.obj debug\gwdbldbl.obj debug\giants.obj mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    -del gwnumd.lib
    lib /OUT:gwnumd.lib debug\*.obj *.obj

linux\gwnum.a: mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    attrib -r linux\gwnum.a
    -del linux\gwnum.a
    -del linux\gwnum.lib
    lib /OUT:linux\gwnum.lib *.obj
    $(objconv) -felf32 linux\gwnum.lib linux\gwnum.a
    attrib -r linux\gwnum.a
    -del linux\gwnum.lib

macosx\gwnum.a: mult.obj multutil.obj mult1.obj mult1aux.obj mult2.obj mult2p.obj mult2a.obj mult2aux.obj mult3.obj mult3p.obj mult3a.obj mult3ap.obj mult4.obj mult4p.obj gianthlp.obj cpuidhlp.obj xmult1.obj xmult1ax.obj xmult2.obj xmult2p.obj xmult2a.obj xmult2ap.obj xmult2ax.obj xmult3.obj xmult3p.obj xmult3a.obj xmult3ap.obj xmult4.obj xmult4p.obj xmult5.obj xmult5p.obj xmult6.obj xmult6p.obj timeit.obj timeitp.obj
    attrib -r macosx\gwnum.a
    -del macosx\gwnum.a
    -del macosx\gwnum.lib
    lib /OUT:macosx\gwnum.lib *.obj
    $(objconv) -fmacho32 -wd1050 macosx\gwnum.lib macosx\gwnum.a
    attrib -r macosx\gwnum.a
    -del macosx\gwnum.lib

# Compile C code

release\cpuid.obj: cpuid.c cpuid.h
    $(cl) /Forelease\cpuid.obj cpuid.c

debug\cpuid.obj: cpuid.c cpuid.h
    $(cld) /Fodebug\cpuid.obj cpuid.c

release\gwnum.obj: gwnum.c gwnum.h
    $(cl) /Forelease\gwnum.obj gwnum.c

debug\gwnum.obj: gwnum.c gwnum.h
    $(cld) /Fodebug\gwnum.obj gwnum.c

release\gwthread.obj: gwthread.c gwthread.h
    $(cl) /Forelease\gwthread.obj gwthread.c

debug\gwthread.obj: gwthread.c gwthread.h
    $(cld) /Fodebug\gwthread.obj gwthread.c

release\gwutil.obj: gwutil.c gwutil.h
    $(cl) /Forelease\gwutil.obj gwutil.c

debug\gwutil.obj: gwutil.c gwutil.h
    $(cld) /Fodebug\gwutil.obj gwutil.c

release\gwdbldbl.obj: gwdbldbl.cpp gwdbldbl.h
    $(cl) /I..\qd /Forelease\gwdbldbl.obj gwdbldbl.cpp

debug\gwdbldbl.obj: gwdbldbl.cpp gwdbldbl.h
    $(cldo) /I..\qd /Fodebug\gwdbldbl.obj gwdbldbl.cpp

release\giants.obj: giants.c giants.h
    $(cl) /Forelease\giants.obj giants.c

debug\giants.obj: giants.c giants.h
    $(cldo) /Fodebug\giants.obj giants.c

release\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cl) /Forelease\ecmstag1.obj ecmstag1.c

debug\ecmstag1.obj: ecmstag1.c gwnum.h
    $(cld) /Fodebug\ecmstag1.obj ecmstag1.c
